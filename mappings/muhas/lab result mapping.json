{
  "id": "lab result mapping",
  "url": "https://ai4hf.eu/fhir/mappings/muhas/LabResultMapping",
  "name": "Lab Result Mapping",
  "title": "The mapping of the MUHAS lab result data into AI4HF LabResult profile.",
  "isDraft": false,
  "source": [
    {
      "alias": "labResult",
      "url": "https://ai4hf.eu/fhir/schemas/muhas/LabResult",
      "joinOn": []
    }
  ],
  "context": {
    "labResultUnitContext": {
      "category": "unit-conversion",
      "url": "$CONTEXT_REPO/muhas/lab-result-unit-conversion.csv"
    }
  },
  "variable": [],
  "mapping": [
    {
      "description": "Urea nitrogen [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "bunExists",
        "language": "text/fhirpath",
        "expression": "name = 'BUN'"
      },
      "expression": {
        "name": "BUN",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "14937-7",
                "display": "Urea nitrogen [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Potassium [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "potassiumExists",
        "language": "text/fhirpath",
        "expression": "name = 'Potassium'"
      },
      "expression": {
        "name": "potassium",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "2823-3",
                "display": "Potassium [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Sodium [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "sodiumExists",
        "language": "text/fhirpath",
        "expression": "name = 'Sodium'"
      },
      "expression": {
        "name": "sodium",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "2951-2",
                "display": "Sodium [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Creatinine [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "creatBSExists",
        "language": "text/fhirpath",
        "expression": "name = 'Creatinine'"
      },
      "expression": {
        "name": "creatBS",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "2160-0",
                "display": "Creatinine [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": "{{mpp:convertAndReturnQuantity(%labResultUnitContext, name, value,unit)}}",
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Red blood cell distribution width",
      "precondition": {
        "name": "RDWExists",
        "language": "text/fhirpath",
        "expression": "name = 'RDW'"
      },
      "expression": {
        "name": "RDW",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "30385-9",
                "display": "Red blood cell distribution width",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "C reactive protein [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "CRPhsExists",
        "language": "text/fhirpath",
        "expression": "name = 'CRPhs'"
      },
      "expression": {
        "name": "CRPhs",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "1988-5",
                "display": "C reactive protein [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Troponin I.cardiac [Mass/volume] in Serum or Plasma by High sensitivity method",
      "precondition": {
        "name": "TropIhsExists",
        "language": "text/fhirpath",
        "expression": "name = 'TropIhs'"
      },
      "expression": {
        "name": "TropIhs",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "89579-7",
                "display": "Troponin I.cardiac [Mass/volume] in Serum or Plasma by High sensitivity method",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Cholesterol in LDL [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "LDLExists",
        "language": "text/fhirpath",
        "expression": "name = 'LDL'"
      },
      "expression": {
        "name": "LDL",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "22748-8",
                "display": "Cholesterol in LDL [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Natriuretic peptide.B prohormone N-Terminal [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "NTproBNPExists",
        "language": "text/fhirpath",
        "expression": "name = 'NTproBNP'"
      },
      "expression": {
        "name": "NTproBNP",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "33762-6",
                "display": "Natriuretic peptide.B prohormone N-Terminal [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Cholesterol in HDL [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "HDLExists",
        "language": "text/fhirpath",
        "expression": "name = 'HDL'"
      },
      "expression": {
        "name": "HDL",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "14646-4",
                "display": "Cholesterol in HDL [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Hemoglobin A1c/Hemoglobin.total in Blood",
      "precondition": {
        "name": "HbA1c%Exists",
        "language": "text/fhirpath",
        "expression": "name = 'HbA1c%'"
      },
      "expression": {
        "name": "HbA1c%",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "4548-4",
                "display": "Hemoglobin A1c/Hemoglobin.total in Blood",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Triglyceride [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "TriGlyExists",
        "language": "text/fhirpath",
        "expression": "name = 'TriGly'"
      },
      "expression": {
        "name": "TriGly",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "14927-8",
                "display": "Triglyceride [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Cholesterol [Moles/volume] in Serum or Plasma",
      "precondition": {
        "name": "CholTotExists",
        "language": "text/fhirpath",
        "expression": "name = 'CholTot'"
      },
      "expression": {
        "name": "CholTot",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "14647-2",
                "display": "Cholesterol [Moles/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Hemoglobin [Mass/volume] in Blood",
      "precondition": {
        "name": "HemoglobinExists",
        "language": "text/fhirpath",
        "expression": "name = 'Hemoglobin'"
      },
      "expression": {
        "name": "Hemoglobin",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "718-7",
                "display": "Hemoglobin [Mass/volume] in Blood",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": "{{mpp:convertAndReturnQuantity(%labResultUnitContext, name, value, unit)}}",
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Glomerular filtration rate/1.73 sq M.predicted [Volume Rate/Area] in Serum, Plasma or Blood",
      "precondition": {
        "name": "eGFRExists",
        "language": "text/fhirpath",
        "expression": "name = 'eGFR'"
      },
      "expression": {
        "name": "eGFR",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "69405-9",
                "display": "Glomerular filtration rate/1.73 sq M.predicted [Volume Rate/Area] in Serum, Plasma or Blood",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Albumin [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "albuminBSExists",
        "language": "text/fhirpath",
        "expression": "name = 'AlbuminBS'"
      },
      "expression": {
        "name": "AlbuminBS",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "1751-7",
                "display": "Albumin [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Ferritin [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "ferritinExists",
        "language": "text/fhirpath",
        "expression": "name = 'Ferritin'"
      },
      "expression": {
        "name": "Ferritin",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "2276-4",
                "display": "Ferritin [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": "{{mpp:convertAndReturnQuantity(%labResultUnitContext, name, value,unit)}}",
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    },
    {
      "description": "Troponin T.cardiac [Mass/volume] in Serum or Plasma",
      "precondition": {
        "name": "TropTnhsExists",
        "language": "text/fhirpath",
        "expression": "name = 'TropTnhs'"
      },
      "expression": {
        "name": "TropTnhs",
        "language": "application/fhir-template+json",
        "value": {
          "id": "{{mpp:getHashedId('Observation', pid & name & date)}}",
          "meta": {
            "profile": [
              "https://datatools4heart.eu/fhir/StructureDefinition/HFR-LabResult"
            ]
          },
          "resourceType": "Observation",
          "status": "final",
          "category": [
            {
              "coding": [
                {
                  "system": "http://terminology.hl7.org/CodeSystem/observation-category",
                  "code": "laboratory",
                  "display": "Laboratory"
                }
              ]
            }
          ],
          "code": {
            "coding": [
              {
                "system": "http://loinc.org",
                "code": "6598-7",
                "display": "Troponin T.cardiac [Mass/volume] in Serum or Plasma",
                "@sliceName": "loincCode"
              }
            ]
          },
          "effectiveDateTime": "{{date.utl:toFhirDateTime('yyyy-MM-dd HH:mm')}}",
          "valueQuantity": {
            "system": "http://unitsofmeasure.org",
            "code": "{{unit}}",
            "unit": "{{unit}}",
            "value": "{{value}}"
          },
          "subject": "{{mpp:createFhirReferenceWithHashedId('Patient', pid)}}",
          "encounter": "{{? iif(visit.exists(),mpp:createFhirReferenceWithHashedId('Encounter', pid & visit.toString()),{})}}"
        }
      }
    }
  ]
}